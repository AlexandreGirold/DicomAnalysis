<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLC Blade Analysis - Review</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        .frequency-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }
        .frequency-badge.daily {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        .frequency-badge.weekly {
            background-color: #f3e5f5;
            color: #6a1b9a;
        }
        .frequency-badge.monthly {
            background-color: #fff3e0;
            color: #e65100;
        }
        .filter-grid {
            display: grid;
            gap: 15px;
        }
        .filter-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .tests-list-compact {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 100%;
        }
        .test-item-compact {
            display: grid;
            grid-template-columns: 80px 200px 150px 180px 180px 120px 1fr;
            gap: 12px;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            align-items: center;
            font-size: 0.9em;
        }
        .test-item-compact:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #2196f3;
            transform: translateY(-1px);
        }
        .test-item-id {
            font-weight: bold;
            color: #1976d2;
            font-size: 0.95em;
        }
        .test-item-name {
            font-weight: 600;
            color: #333;
        }
        .test-item-operator {
            color: #666;
        }
        .test-item-date {
            color: #666;
            font-size: 0.9em;
        }
        .test-item-result {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            text-align: center;
        }
        .result-pass { background: #c8e6c9; color: #2e7d32; }
        .result-fail { background: #ffcdd2; color: #c62828; }
        .result-warning { background: #fff9c4; color: #f57f17; }
        .result-complete { background: #e1bee7; color: #6a1b9a; }
        .result-na { background: #e0e0e0; color: #616161; }
        @media (max-width: 1200px) {
            .test-item-compact {
                grid-template-columns: 60px 150px 120px 140px 100px;
                gap: 8px;
                font-size: 0.85em;
            }
            .test-item-date:last-of-type,
            .test-item-operator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üî¨ MLC Blade Position Analysis</h1>
            <nav>
                <a href="/" class="nav-link">Analysis</a>
                <a href="/static/review.html" class="nav-link active">Review</a>
            </nav>
        </header>

        <main>
            <section class="filter-section">
                <h2>Review Historical Tests</h2>
                
                <div class="filter-card">
                    <h3>üîç Filter Tests</h3>
                    <div class="filter-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <!-- Test Type Selection -->
                        <div class="filter-item">
                            <label for="testTypeFilter">Test Type:</label>
                            <select id="testTypeFilter" class="form-select">
                                <option value="">All Tests</option>
                                <option value="daily">Daily Tests</option>
                                <option value="weekly">Weekly Tests</option>
                                <option value="monthly">Monthly Tests</option>
                            </select>
                        </div>
                        
                        <!-- Specific Test Selection -->
                        <div class="filter-item">
                            <label for="specificTestFilter">Specific Test:</label>
                            <select id="specificTestFilter" class="form-select">
                                <option value="">All</option>
                                <!-- Daily -->
                                <optgroup label="Daily Tests">
                                    <option value="safety_systems">Safety Systems</option>
                                </optgroup>
                                <!-- Weekly -->
                                <optgroup label="Weekly Tests">
                                    <option value="niveau_helium">Niveau Helium</option>
                                    <option value="mlc_leaf_jaw">MLC Leaf & Jaw</option>
                                    <option value="mvic">MVIC</option>
                                    <option value="mvic_fente_v2">MVIC Fente V2</option>
                                    <option value="piqt">PIQT</option>
                                </optgroup>
                                <!-- Monthly -->
                                <optgroup label="Monthly Tests">
                                    <option value="position_table_v2">Position Table V2</option>
                                    <option value="alignement_laser">Alignement Laser</option>
                                    <option value="quasar">Quasar</option>
                                    <option value="indice_quality">Indice Quality</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <!-- Date Range -->
                        <div class="filter-item">
                            <label for="startDate">Start Date:</label>
                            <input type="date" id="startDate" class="form-input">
                        </div>
                        <div class="filter-item">
                            <label for="endDate">End Date:</label>
                            <input type="date" id="endDate" class="form-input">
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="filter-item" style="display: flex; gap: 10px; align-items: flex-end;">
                            <button id="applyFilterBtn" class="btn btn-primary" style="flex: 1;">
                                üîç Apply Filter
                            </button>
                            <button id="clearFilterBtn" class="btn btn-secondary" style="flex: 1;">
                                üóëÔ∏è Clear
                            </button>
                        </div>
                    </div>
                </div>

                <div class="stats-card">
                    <h3>üìä Current View Statistics</h3>
                    <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                        <div class="stat-item">
                            <span class="label">Tests Shown:</span>
                            <span id="shownTests" class="value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="label">Test Type:</span>
                            <span id="currentTestType" class="value">All</span>
                        </div>
                        <div class="stat-item">
                            <span class="label">Date Range:</span>
                            <span id="currentDateRange" class="value">All dates</span>
                        </div>
                    </div>
                </div>
            </section>

            <section id="loadingSection" class="loading-section" style="display: none;">
                <div class="spinner"></div>
                <p>Loading tests...</p>
            </section>

            <section class="tests-section">
                <h3>Test History</h3>
                <div id="testsContainer" class="tests-list-compact">
                    <p class="placeholder-text">No tests found. Run some analyses first!</p>
                </div>
            </section>

            <section id="testDetailSection" class="test-detail-section" style="display: none;">
                <div class="detail-header">
                    <h2>Test Details</h2>
                    <button class="btn btn-secondary" onclick="closeTestDetail()">‚úñ Close</button>
                </div>

                <div class="detail-info">
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="label">Test ID:</span>
                            <span id="detailTestId" class="value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Filename:</span>
                            <span id="detailFilename" class="value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Test Date:</span>
                            <span id="detailDate" class="value">-</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Upload Date:</span>
                            <span id="detailUploadDate" class="value">-</span>
                        </div>
                    </div>
                </div>

                <div class="summary-card">
                    <h3>Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="label">Total Blades:</span>
                            <span id="detailTotalBlades" class="value">-</span>
                        </div>
                        <div class="summary-item success">
                            <span class="label">OK:</span>
                            <span id="detailOkBlades" class="value">-</span>
                        </div>
                        <div class="summary-item warning">
                            <span class="label">Out of Tolerance:</span>
                            <span id="detailOutOfTolerance" class="value">-</span>
                        </div>
                        <div class="summary-item info">
                            <span class="label">Closed:</span>
                            <span id="detailClosedBlades" class="value">-</span>
                        </div>
                    </div>
                </div>

                <div class="visualization-section">
                    <h3>Visualizations</h3>
                    <div id="detailVisualizationDropdown">
                        <select id="detailVizSelect" class="form-select">
                            <option value="">-- No visualizations available --</option>
                        </select>
                    </div>
                    <div id="detailVisualizationDisplay" class="visualization-display">
                        <p class="placeholder-text">No visualizations available for this test</p>
                    </div>
                </div>

                <div class="results-table-section">
                    <h3>Blade Measurements</h3>
                    <div class="table-controls">
                        <input type="text" id="detailSearchInput" class="search-input" placeholder="Search blade pair...">
                        <select id="detailStatusFilter" class="form-select">
                            <option value="">All Statuses</option>
                            <option value="OK">OK</option>
                            <option value="OUT_OF_TOLERANCE">Out of Tolerance</option>
                            <option value="CLOSED">Closed</option>
                        </select>
                    </div>
                    <div class="table-wrapper">
                        <table id="detailResultsTable">
                            <thead>
                                <tr>
                                    <th>Blade Pair</th>
                                    <th>Distance Sup (mm)</th>
                                    <th>Distance Inf (mm)</th>
                                    <th>Field Size (mm)</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="detailResultsTableBody">
                                <!-- Results will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="downloadReportBtn" class="btn btn-primary">
                        üìÑ Download PDF Report
                    </button>
                    <button id="deleteTestBtn" class="btn btn-danger">
                        üóëÔ∏è Delete Test
                    </button>
                </div>
            </section>
        </main>

        <footer>
            <p>MLC Blade Position Analysis System | ¬© 2025</p>
        </footer>
    </div>

    <script src="/static/review.js"></script>
</body>
</html>
